// schema.prisma
generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Department {
    id         String     @id @default(uuid()) @db.Uuid
    name       String
    shortName  String
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    employees  employee[]
    students   Student[]
    activities Activity[]
}

model employee {
    id           String     @id @default(uuid()) @db.Uuid
    fullname     String
    email        String     @unique
    password     String
    phone        String?
    department   Department @relation(fields: [departmentId], references: [id])
    departmentId String
    role         Role       @default(teacher)
    createdAt    DateTime   @default(now())
    updatedAt    DateTime   @updatedAt
    activities   Activity[]
}

model Student {
    id           String        @id
    fullname     String
    department   Department    @relation(fields: [departmentId], references: [id])
    departmentId String
    birthdate    DateTime
    email        String        @unique
    phone        String?
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    status       StudentStatus @default(active)
    attendances  Attendance[]
}

model Activity {
    id             String         @id @default(uuid()) @db.Uuid
    name           String //ชื่อกิจกรรม
    description    String? //คำอธิบายกิจกรรม
    date           DateTime //วันที่จัดกิจกรรม
    address        String //สถานที่จัดกิจกรรม
    status         ActivityStatus @default(planned) //สถานะกิจกรรม
    departmentId   String //Foreign key to Department
    peopleCount    Int? //จำนวนคนที่เข้าร่วมกิจกรรม
    maxPeopleCount Int? //จำนวนคนสูงสุดที่สามารถเข้าร่วมกิจกรรม
    fileActivity   String? //ไฟล์กิจกรรม (เช่น PDF, รูปภาพ)
    hour           Int? //จำนวนชั่วโมงกิจกรรม
    createdAt      DateTime       @default(now())
    updatedAt      DateTime       @updatedAt
    employeeId     String //Foreign key to employee
    employee       employee       @relation(fields: [employeeId], references: [id])
    department     Department     @relation(fields: [departmentId], references: [id])
    attendances    Attendance[]
}

model Attendance {
    id         String           @id @default(uuid()) @db.Uuid
    student    Student          @relation(fields: [studentId], references: [id])
    studentId  String
    activity   Activity         @relation(fields: [activityId], references: [id])
    activityId String
    reason     String?
    status     AttendanceStatus @default(joined)
    createdAt  DateTime         @default(now())
    updatedAt  DateTime         @updatedAt
}

enum Role {
    admin
    teacher
}

enum AttendanceStatus {
    joined
    accepted
    rejected
    Inprogress
    completed
    uncompleted
}

enum ActivityStatus {
    planned
    inprogress
    completed
    cancelled
}

enum StudentStatus {
    active
    graduated
    expelled
}
